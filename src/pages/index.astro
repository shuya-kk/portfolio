---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";
import AppCard from "../components/AppCard.astro";
import BlogCard from "../components/BlogCard.astro";
import SectionHeader from "../components/SectionHeader.astro";
import appsData from "../data/apps.json";

const allPosts = await getCollection("blog");
const latestPosts = allPosts
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
    .slice(0, 4);

const featuredApps = appsData
    .sort((a: any, b: any) => {
        // First sort by rating count (popularity)
        const countDiff = (b.ratingCount || 0) - (a.ratingCount || 0);
        if (countDiff !== 0) return countDiff;
        // Then sort by rating value
        return (b.rating || 0) - (a.rating || 0);
    })
    .slice(0, 4);
---

<Layout title="PORTFOLIO">
    <!-- Hero Section -->
    <section class="section-padding flex items-center min-h-[70vh]">
        <div class="container-custom">
            <div class="max-w-3xl">
                <h1 class="heading-large mb-10">
                    iOSアプリ開発・ポートフォリオ
                </h1>
                <p
                    class="text-2xl text-secondary leading-relaxed mb-12 font-medium max-w-2xl"
                >
                    SwiftUIを用いたモダンなiOSアプリ制作を行っています。
                </p>
                <div class="flex gap-6">
                    <a href="/portfolio/apps" class="btn-primary">
                        制作アプリ一覧
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Apps Section -->
    <section
        id="apps"
        class="section-padding bg-white border-y border-slate-50"
    >
        <div class="container-custom">
            <div
                class="mb-20 flex flex-col md:flex-row md:items-end justify-between gap-8"
            >
                <div class="max-w-xl">
                    <h2 class="heading-medium mb-6">開発アプリ</h2>
                    <p class="text-secondary text-lg">
                        制作したiOSアプリケーションの一部をご紹介します。
                    </p>
                </div>
                <a
                    href="/portfolio/apps"
                    class="text-slate-900 font-bold tracking-widest uppercase hover:opacity-70 transition-opacity flex items-center gap-2 pb-1 border-b-2 border-slate-900"
                >
                    View All Apps
                    <svg
                        class="w-4 h-4"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        ><path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg
                    >
                </a>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                {
                    featuredApps.map((app: any) => (
                        <AppCard
                            name={app.name}
                            description={app.description}
                            iconUrl={app.iconPlaceholder}
                            appStoreUrl={app.appStoreLink}
                            features={app.features}
                            isFeatured={false}
                            rating={app.rating}
                            ratingCount={app.ratingCount}
                        />
                    ))
                }
            </div>
        </div>
    </section>

    <!-- Posts Section -->
    <section
        id="posts"
        class="section-padding bg-background border-y border-border"
    >
        <div class="container-custom">
            <SectionHeader
                title="ブログ"
                subtitle="開発の記録や技術的な備忘録です。"
            />

            <div
                class="divide-y divide-border bg-surface border border-border rounded-xl"
            >
                {
                    latestPosts.map((post) => (
                        <BlogCard
                            title={post.data.title}
                            date={post.data.pubDate}
                            slug={post.slug}
                            tags={post.data.tags}
                        />
                    ))
                }
            </div>

            <div class="mt-12">
                <a
                    href="/portfolio/blog"
                    class="text-accent font-medium hover:underline inline-flex items-center gap-2"
                >
                    すべての記事を見る
                    <svg
                        class="w-4 h-4"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        ><path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 5l7 7-7 7"></path></svg
                    >
                </a>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="section-padding">
        <div class="container-custom">
            <div class="max-w-3xl">
                <h2 class="heading-medium mb-8">私について</h2>
                <div class="space-y-6 text-primary leading-relaxed text-lg">
                    <p>
                        Swift /
                        SwiftUIを中心に、直感的で使いやすいiOSアプリの開発を行っています。
                    </p>
                </div>

                <div class="mt-12 flex items-center gap-6">
                    <a
                        href="https://github.com/shuya-kk"
                        target="_blank"
                        class="text-secondary hover:text-primary transition-colors font-medium flex items-center gap-2"
                    >
                        GitHub
                        <svg
                            class="w-4 h-4"
                            fill="currentColor"
                            viewBox="0 0 24 24"
                            ><path
                                d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-10.886 0-6.627-5.373-12-12-12z"
                            ></path></svg
                        >
                    </a>
                </div>
            </div>
        </div>
    </section>
</Layout>
