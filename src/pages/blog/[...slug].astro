---
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";

type Props = {
    post: CollectionEntry<"blog">;
};

export async function getStaticPaths() {
    const posts = await getCollection("blog");
    return posts.map((post) => ({
        params: { slug: post.slug },
        props: { post },
    }));
}

const { post } = Astro.props as Props;
const { Content } = await post.render();
---

<Layout title={post.data.title} description={post.data.description}>
    <div class="container-custom section-padding pt-40">
        <div class="max-w-3xl mx-auto">
            <!-- Back Link -->
            <a
                href="/portfolio/blog"
                class="inline-flex items-center gap-3 text-secondary hover:text-primary transition-all mb-16 font-bold text-[11px] uppercase tracking-widest group"
            >
                <svg
                    class="w-4 h-4 transition-transform group-hover:-translate-x-1"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    ><path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2.5"
                        d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg
                >
                Back to Blog
            </a>

            <article>
                <header class="mb-16">
                    <time
                        datetime={post.data.pubDate.toISOString()}
                        class="text-secondary font-bold text-[11px] tracking-widest block mb-6 font-mono opacity-60"
                    >
                        {
                            post.data.pubDate
                                .toLocaleDateString("ja-JP", {
                                    year: "numeric",
                                    month: "2-digit",
                                    day: "2-digit",
                                })
                                .replace(/\//g, ".")
                        }
                    </time>
                    <h1 class="heading-large mb-10">{post.data.title}</h1>

                    {
                        post.data.tags && (
                            <div class="flex flex-wrap gap-2">
                                {post.data.tags.map((tag) => (
                                    <a
                                        href={`/portfolio/blog/tag/${tag}`}
                                        class="text-[10px] font-bold px-4 py-1.5 bg-slate-50 text-slate-500 rounded-full border border-slate-100 hover:border-accent hover:text-accent transition-all uppercase tracking-wider"
                                    >
                                        #{tag}
                                    </a>
                                ))}
                            </div>
                        )
                    }
                </header>

                <div
                    class="prose prose-slate prose-lg max-w-none leading-relaxed tracking-tight text-primary/80"
                >
                    <Content />
                </div>

                <div class="mt-24 pt-12 border-t border-slate-50">
                    <a
                        href="/portfolio/blog"
                        class="btn-primary inline-flex items-center"
                    >
                        記事一覧に戻る
                    </a>
                </div>
            </article>
        </div>
    </div>
</Layout>
